<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="pragma" content="no-cache"/>
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name ="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
        <meta charset="utf-8"/>
        <title>Bandruf#1</title>
        <style>
            html, body { height: 100%; }
            body {
              background: #000;
              color: #cccccc;
              margin: 0;
              padding: 0;
              border: 0;
              overflow: hidden;
              height: 100%;
            }
            .gm4html5_div_class {
              margin: 0;
              padding: 0;
              border: 0;
              width: 100%;
              height: 100%;
              display: flex;
              align-items: center;
              justify-content: center;
              overflow: hidden;
            }
            canvas {
                      image-rendering: optimizeSpeed;
                      -webkit-interpolation-mode: nearest-neighbor;
                      -ms-touch-action: none;
                      margin: 0;
                      padding: 0;
                      border: 0;
                      display: block;
                      width: 100%;
                      height: 100%;
            }
            /* Fullscreen: make canvas match viewport and pin to top-left (avoid engine offsets) */
            :-webkit-full-screen #canvas, :fullscreen #canvas {
               width: 100vw;
               height: 100vh;
               position: fixed;
               left: 0;
               top: 0;
               margin: 0;
            }

            /* START - Login Dialog Box */
            div.gm4html5_login
            {
                 padding: 20px;
                 position: absolute;
                 border: solid 2px #000000;
                 background-color: #404040;
                 color:#00ff00;
                 border-radius: 15px;
                 box-shadow: #101010 20px 20px 40px;
            }
            div.gm4html5_cancel_button
            {
                 float: right;
            }
            div.gm4html5_login_button
            {
                 float: left;
            }
            div.gm4html5_login_header
            {
                 text-align: center;
            }
            /* END - Login Dialog Box */
        </style>
    </head>

    <body>
        <div class="gm4html5_div_class" id="gm4html5_div_id">
        <img src="html5game/splash.png" id="GM4HTML5_loadingscreen" alt="GameMaker:HTML5 loading screen" style="display:none;"/>
            <!-- Create the canvas element the game draws to -->
            <canvas id="canvas">
                     <p>Your browser doesn't support HTML5 canvas.</p>
            </canvas>
            <script>
            (function(){
              const canvas = document.getElementById('canvas');
              function postStatus(type, data){
                try{ parent.postMessage({type: type, data: data}, '*'); }catch(e){}
              }
              function resizeCanvas(){
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
              }
              window.addEventListener('resize', resizeCanvas);
              function onFullscreenChange(){
                resizeCanvas();
                postStatus('retrobowl-fullscreenchange', {fullscreen: !!(document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement)});
              }
              document.addEventListener('fullscreenchange', onFullscreenChange);
              document.addEventListener('webkitfullscreenchange', onFullscreenChange);
              document.addEventListener('mozfullscreenchange', onFullscreenChange);
              document.addEventListener('MSFullscreenChange', onFullscreenChange);

              // Listen for parent requests to toggle fullscreen for the canvas
              window.addEventListener('message', function(ev){
                if (!ev.data || ev.data.type !== 'toggle-fullscreen') return;
                try {
                  if (!document.fullscreenElement) {
                    if (canvas.requestFullscreen) canvas.requestFullscreen();
                    else if (canvas.webkitRequestFullscreen) canvas.webkitRequestFullscreen();
                    else if (canvas.mozRequestFullScreen) canvas.mozRequestFullScreen();
                    else if (canvas.msRequestFullscreen) canvas.msRequestFullscreen();
                  } else {
                    if (document.exitFullscreen) document.exitFullscreen();
                    else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
                    else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
                    else if (document.msExitFullscreen) document.msExitFullscreen();
                  }
                } catch (e) {
                  postStatus('retrobowl-error', {message: 'toggle-fullscreen failed: ' + e.message});
                }
              });

              window.onerror = function(msg, src, line, col, err){
                postStatus('retrobowl-error', {message: msg, source: src, line: line, column: col, error: err && err.stack});
              };
              // Load game runtime and init
              var script = document.createElement('script');
              script.src = 'html5game/RetroBowl.js';
              script.onload = function(){
                postStatus('retrobowl-script-loaded');
                // initialize after script loaded and all deps ready
                try{
                  if(typeof GameMaker_Init === 'function'){
                    GameMaker_Init();
                    postStatus('retrobowl-ready');
                  }else{
                    postStatus('retrobowl-error', {message:'GameMaker_Init not found'});
                  }
                }catch(e){
                  postStatus('retrobowl-error', {message: e.message, stack: e.stack});
                }
                // ensure canvas sized
                resizeCanvas();
              };
              script.onerror = function(e){
                postStatus('retrobowl-error', {message:'Failed to load RetroBowl.js'});
              };
              document.body.appendChild(script);
              // initial size
              resizeCanvas();
            })();
            </script>
    </body>
</html>
